!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).TomSelect=t()}(this,function(){"use strict";function n(e,t){e.split(/\s+/).forEach(e=>{t(e)})}var p,u;const q=new RegExp("[̀-ͯ·ʾ]","g"),t={"æ":"ae","ⱥ":"a","ø":"o"},D=new RegExp(Object.keys(t).join("|"),"g"),N=[[67,67],[160,160],[192,438],[452,652],[961,961],[1019,1019],[1083,1083],[1281,1289],[1984,1984],[5095,5095],[7429,7441],[7545,7549],[7680,7935],[8580,8580],[9398,9449],[11360,11391],[42792,42793],[42802,42851],[42873,42897],[42912,42922],[64256,64260],[65313,65338],[65345,65370]],h=e=>e.normalize("NFKD").replace(q,"").toLowerCase().replace(D,function(e){return t[e]}),g=(e,t="|")=>{if(1==e.length)return e[0];var i=1;return e.forEach(e=>{i=Math.max(i,e.length)}),1==i?"["+e.join("")+"]":"(?:"+e.join(t)+")"},v=i=>{if(1===i.length)return[[i]];var s=[];return v(i.substring(1)).forEach(function(e){var t=e.slice(0);t[0]=i.charAt(0)+t[0],s.push(t),(t=e.slice(0)).unshift(i.charAt(0)),s.push(t)}),s},z=(e,t)=>{if(e)return e[t]},R=(e,t)=>{if(e){for(var i,s=t.split(".");(i=s.shift())&&(e=e[i]););return e}},c=(e,t,i)=>{var s;return!e||-1===(s=(e+="").search(t.regex))?0:(t=t.string.length/e.length,0===s&&(t+=.5),t*i)},b=e=>(e+"").replace(/([\$\(-\+\.\?\[-\^\{-\}])/g,"\\$1"),s=(e,t)=>{var i=e[t];if("function"==typeof i)return i;i&&!Array.isArray(i)&&(e[t]=[i])},w=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var i in e)e.hasOwnProperty(i)&&t(e[i],i)},m=(e,t)=>"number"==typeof e&&"number"==typeof t?t<e?1:e<t?-1:0:(e=h(e+"").toLowerCase())>(t=h(t+"").toLowerCase())?1:e<t?-1:0;class H{constructor(e,t){this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,a,t){if(!e||!e.length)return[];const c=[],i=e.split(/\s+/);var d;return t&&(d=new RegExp("^("+Object.keys(t).map(b).join("|")+"):(.*)$")),i.forEach(e=>{let t,i=null,s=null;var n,o,r,l;d&&(t=e.match(d))&&(i=t[1],e=t[2]),0<e.length&&(s=b(e),this.settings.diacritics&&(s=(n=s,void 0===u&&(o={},N.forEach(e=>{for(let i=e[0];i<=e[1];i++){let e=String.fromCharCode(i),t=h(e);var s;t!=e.toLowerCase()&&(t in o||(o[t]=[t]),s=new RegExp(g(o[t]),"iu"),e.match(s)||o[t].push(e))}}),r=(r=Object.keys(o)).sort((e,t)=>t.length-e.length),p=new RegExp("("+g(r)+"[̀-ͯ·ʾ]*)","g"),l={},r.sort((e,t)=>e.length-t.length).forEach(e=>{var t=v(e).map(e=>(e=e.map(e=>o.hasOwnProperty(e)?g(o[e]):e),g(e,"")));l[e]=g(t)}),u=l),n.normalize("NFKD").toLowerCase().split(p).map(e=>{if(""==e)return"";var t=h(e);if(u.hasOwnProperty(t))return u[t];t=e.normalize("NFC");return t!=e?g([e,t]):e}).join(""))),a&&(s="\\b"+s)),c.push({string:e,regex:s?new RegExp(s,"iu"):null,field:i})}),c}getScoreFunction(e,t){e=this.prepareSearch(e,t);return this._getScoreFunction(e)}_getScoreFunction(e){const n=e.tokens,o=n.length;if(!o)return function(){return 0};const s=e.options.fields,r=e.weights,t=s.length,l=e.getAttrFn;if(!t)return function(){return 1};const a=1===t?function(e,t){var i=s[0].field;return c(l(t,i),e,r[i])}:function(i,s){var e,n=0;return i.field?(e=l(s,i.field),!i.regex&&e?n+=1/t:n+=c(e,i,1)):w(r,(e,t)=>{n+=c(l(s,t),i,e)}),n/t};return 1===o?function(e){return a(n[0],e)}:"and"===e.options.conjunction?function(e){for(var t,i=0,s=0;i<o;i++){if((t=a(n[i],e))<=0)return 0;s+=t}return s/o}:function(t){var i=0;return w(n,e=>{i+=a(e,t)}),i/o}}getSortFunction(e,t){e=this.prepareSearch(e,t);return this._getSortFunction(e)}_getSortFunction(i){var s,e,t;const n=this,o=i.options,r=!i.query&&o.sort_empty?o.sort_empty:o.sort,l=[],a=[];if("function"==typeof r)return r.bind(this);function c(e,t){return"$score"===e?t.score:i.getAttrFn(n.items[t.id],e)}if(r)for(s=0,e=r.length;s<e;s++)!i.query&&"$score"===r[s].field||l.push(r[s]);if(i.query){for(t=!0,s=0,e=l.length;s<e;s++)if("$score"===l[s].field){t=!1;break}t&&l.unshift({field:"$score",direction:"desc"})}else for(s=0,e=l.length;s<e;s++)if("$score"===l[s].field){l.splice(s,1);break}for(s=0,e=l.length;s<e;s++)a.push("desc"===l[s].direction?-1:1);const d=l.length;if(d){if(1!==d)return function(e,t){for(var i,s=0;s<d;s++)if(i=l[s].field,i=a[s]*m(c(i,e),c(i,t)))return i;return 0};{const i=l[0].field,s=a[0];return function(e,t){return s*m(c(i,e),c(i,t))}}}return null}prepareSearch(t,e){const i={};e=Object.assign({},e);if(s(e,"sort"),s(e,"sort_empty"),e.fields){s(e,"fields");const t=[];e.fields.forEach(e=>{"string"==typeof e&&(e={field:e,weight:1}),t.push(e),i[e.field]="weight"in e?e.weight:1}),e.fields=t}return{options:e,query:t.toLowerCase().trim(),tokens:this.tokenize(t,e.respect_word_boundaries,i),total:0,items:[],weights:i,getAttrFn:e.nesting?R:z}}search(e,i){var s,n=this.prepareSearch(e,i);i=n.options,e=n.query;const o=i.score||this._getScoreFunction(n);e.length?w(this.items,(e,t)=>{s=o(e),(!1===i.filter||0<s)&&n.items.push({score:s,id:t})}):w(this.items,(e,t)=>{n.items.push({score:1,id:t})});e=this._getSortFunction(n);return e&&n.items.sort(e),n.total=n.items.length,"number"==typeof i.limit&&(n.items=n.items.slice(0,i.limit)),n}}const f=t=>{if(t.jquery)return t[0];if(t instanceof HTMLElement)return t;if(y(t)){let e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild}return document.querySelector(t)},y=e=>"string"==typeof e&&-1<e.indexOf("<"),i=(e,t)=>{var i=document.createEvent("HTMLEvents");i.initEvent(t,!0,!1),e.dispatchEvent(i)},o=(e,t)=>{Object.assign(e.style,t)},_=(e,...t)=>{var i=r(t);(e=l(e)).map(t=>{i.map(e=>{t.classList.add(e)})})},I=(e,...t)=>{var i=r(t);(e=l(e)).map(t=>{i.map(e=>{t.classList.remove(e)})})},r=e=>{var t=[];return w(e,e=>{"string"==typeof e&&(e=e.trim().split(/[\11\12\14\15\40]/)),Array.isArray(e)&&(t=t.concat(e))}),t.filter(Boolean)},l=e=>e=Array.isArray(e)?e:[e],C=(e,t,i)=>{if(!i||i.contains(e))for(;e&&e.matches;){if(e.matches(t))return e;e=e.parentNode}},a=(e,t=0)=>0<t?e[e.length-1]:e[0],d=(e,t)=>{if(!e)return-1;t=t||e.nodeName;for(var i=0;e=e.previousElementSibling;)e.matches(t)&&i++;return i},S=(i,e)=>{w(e,(e,t)=>{null==e?i.removeAttribute(t):i.setAttribute(t,""+e)})},O=(e,t)=>{e.parentNode&&e.parentNode.replaceChild(t,e)},B=(e,r)=>{if(null!==r){if("string"==typeof r){if(!r.length)return;r=new RegExp(r,"i")}const l=e=>{var t,i,s;{if(3===e.nodeType)return(s=(t=e).data.match(r))&&0<t.data.length?((i=document.createElement("span")).className="highlight",(t=t.splitText(s.index)).splitText(s[0].length),s=t.cloneNode(!0),i.appendChild(s),O(t,i),1):0;var n=e;if(1===n.nodeType&&n.childNodes&&!/(script|style)/i.test(n.tagName)&&("highlight"!==n.className||"SPAN"!==n.tagName))for(var o=0;o<n.childNodes.length;++o)o+=l(n.childNodes[o]);return 0}};l(e)}},A="undefined"!=typeof navigator&&/Mac/.test(navigator.userAgent)?"metaKey":"ctrlKey";var K={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(e){return 0<e.length},render:{}};const x=e=>null==e?null:k(e),k=e=>"boolean"==typeof e?e?"1":"0":e+"",F=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),M=(t,i,e)=>{var s,n=t.trigger,o={};for(s of(t.trigger=function(){var e=arguments[0];if(-1===i.indexOf(e))return n.apply(t,arguments);o[e]=arguments},e.apply(t,[]),t.trigger=n,i))s in o&&n.apply(t,o[s])},L=(e,t=!1)=>{e&&(e.preventDefault(),t&&e.stopPropagation())},E=(e,t,i,s)=>{e.addEventListener(t,i,s)},P=(e,t)=>!!t&&!!t[e]&&1==(t.altKey?1:0)+(t.ctrlKey?1:0)+(t.shiftKey?1:0)+(t.metaKey?1:0),T=(e,t)=>{return e.getAttribute("id")||(e.setAttribute("id",t),t)},Q=e=>e.replace(/[\\"']/g,"\\$&"),V=(e,t)=>{t&&e.append(t)};function G(e,t){var n=Object.assign({},K,t),i=n.dataAttr,o=n.labelField,r=n.valueField,l=n.disabledField,a=n.optgroupField,c=n.optgroupLabelField,d=n.optgroupValueField,s=e.tagName.toLowerCase(),p=e.getAttribute("placeholder")||e.getAttribute("data-placeholder");p||n.allowEmptyOption||(O=e.querySelector('option[value=""]'))&&(p=O.textContent);var u,h,g,v,m,f,y={placeholder:p,options:[],optgroups:[],items:[],maxItems:null};if("select"===s)h=y.options,g={},v=1,m=e=>{var e=Object.assign({},e.dataset),t=i&&e[i];return e="string"==typeof t&&t.length?Object.assign(e,JSON.parse(t)):e},f=(e,t)=>{var i,s=x(e.value);null!=s&&(s||n.allowEmptyOption)&&(g.hasOwnProperty(s)?t&&((i=g[s][a])?Array.isArray(i)?i.push(t):g[s][a]=[i,t]:g[s][a]=t):((i=m(e))[o]=i[o]||e.textContent,i[r]=i[r]||s,i[l]=i[l]||e.disabled,i[a]=i[a]||t,i.$option=e,g[s]=i,h.push(i)),e.selected&&y.items.push(s))},y.maxItems=e.hasAttribute("multiple")?null:1,w(e.children,e=>{var t,i,s;"optgroup"===(u=e.tagName.toLowerCase())?((s=m(t=e))[c]=s[c]||t.getAttribute("label")||"",s[d]=s[d]||v++,s[l]=s[l]||t.disabled,y.optgroups.push(s),i=s[d],w(t.children,e=>{f(e,i)})):"option"===u&&f(e)});else{const b=e.getAttribute(i);if(b)y.options=JSON.parse(b),w(y.options,e=>{y.items.push(e[r])});else{var O=e.value.trim()||"";if(n.allowEmptyOption||O.length){const b=O.split(n.delimiter);w(b,e=>{const t={};t[o]=e,t[r]=e,y.options.push(t)}),y.items=b}}}return Object.assign({},K,y,t)}var j,U=0;class e extends(j=class{constructor(){this._events={}}on(e,t){n(e,e=>{this._events[e]=this._events[e]||[],this._events[e].push(t)})}off(e,t){var i=arguments.length;0!==i?n(e,e=>{if(1===i)return delete this._events[e];e in this._events!=0&&this._events[e].splice(this._events[e].indexOf(t),1)}):this._events={}}trigger(e,...i){var s=this;n(e,e=>{if(e in s._events!=0)for(var t of s._events[e])t.apply(s,i)})}},j.plugins={},class extends j{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){j.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,i;const s=this,n=[];if(Array.isArray(e))e.forEach(e=>{"string"==typeof e?n.push(e):(s.plugins.settings[e.name]=e.options,n.push(e.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(s.plugins.settings[t]=e[t],n.push(t));for(;i=n.shift();)s.require(i)}loadPlugin(e){var t=this.plugins,i=j.plugins[e];if(!j.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');t.requested[e]=!0,t.loaded[e]=i.fn.apply(this,[this.plugins.settings[e]||{}]),t.names.push(e)}require(e){var t=this.plugins;if(!this.plugins.loaded.hasOwnProperty(e)){if(t.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');this.loadPlugin(e)}return t.loaded[e]}}){constructor(e,t){super(),this.order=0,this.isOpen=!1,this.isDisabled=!1,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.hasOptions=!1,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],U++;var i=f(e);if(i.tomselect)throw new Error("Tom Select already initialized on this element");i.tomselect=this,e=(window.getComputedStyle&&window.getComputedStyle(i,null)).getPropertyValue("direction");const s=G(i,t);this.settings=s,this.input=i,this.tabIndex=i.tabIndex||0,this.is_select_tag="select"===i.tagName.toLowerCase(),this.rtl=/rtl/i.test(e),this.inputId=T(i,"tomselect-"+U),this.isRequired=i.required,this.sifter=new H(this.options,{diacritics:s.diacritics}),s.mode=s.mode||(1===s.maxItems?"single":"multi"),"boolean"!=typeof s.hideSelected&&(s.hideSelected="multi"===s.mode),"boolean"!=typeof s.hidePlaceholder&&(s.hidePlaceholder="multi"!==s.mode);var n,o=s.createFilter;"function"!=typeof o&&((o="string"==typeof o?new RegExp(o):o)instanceof RegExp?s.createFilter=e=>o.test(e):s.createFilter=()=>!0),this.initializePlugins(s.plugins),this.setupCallbacks(),this.setupTemplates();const r=f("<div>"),l=f("<div>"),a=this._render("dropdown"),c=f('<div role="listbox" tabindex="-1">'),d=this.input.getAttribute("class")||"",p=s.mode;_(r,s.wrapperClass,d,p),_(l,s.controlClass),V(r,l),_(a,s.dropdownClass,p),s.copyClassesToDropdown&&_(a,d),_(c,s.dropdownContentClass),V(a,c),f(s.dropdownParent||r).appendChild(a),y(s.controlInput)?(n=f(s.controlInput),w(["autocorrect","autocapitalize","autocomplete"],e=>{i.getAttribute(e)&&S(n,{[e]:i.getAttribute(e)})}),n.tabIndex=-1,l.appendChild(n),this.focus_node=n):s.controlInput?(n=f(s.controlInput),this.focus_node=n):(n=f("<input/>"),this.focus_node=l),this.wrapper=r,this.dropdown=a,this.dropdown_content=c,this.control=l,this.control_input=n,this.setup()}setup(){const i=this,e=i.settings,s=i.control_input,n=i.dropdown,t=i.dropdown_content,o=i.wrapper,r=i.control,l=i.input,a=i.focus_node,c={passive:!0},d=i.inputId+"-ts-dropdown",p=(S(t,{id:d}),S(a,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":d}),T(a,i.inputId+"-ts-control")),u="label[for='"+i.inputId.replace(/['"\\]/g,"\\$&")+"']",h=document.querySelector(u),g=i.focus.bind(i);if(h){E(h,"click",g),S(h,{for:p});const e=T(h,i.inputId+"-ts-label");S(a,{"aria-labelledby":e}),S(t,{"aria-labelledby":e})}if(o.style.width=l.style.width,i.plugins.names.length){const e="plugin-"+i.plugins.names.join(" plugin-");_([o,n],e)}var v,m,f;(null===e.maxItems||1<e.maxItems)&&i.is_select_tag&&S(l,{multiple:"multiple"}),i.settings.placeholder&&S(s,{placeholder:e.placeholder}),!i.settings.splitOn&&i.settings.delimiter&&(i.settings.splitOn=new RegExp("\\s*"+b(i.settings.delimiter)+"+\\s*")),e.load&&e.loadThrottle&&(e.load=(v=e.load,m=e.loadThrottle,function(e,t){var i=this;f&&(i.loading=Math.max(i.loading-1,0),clearTimeout(f)),f=setTimeout(function(){f=null,i.loadedSearches[e]=!0,v.call(i,e,t)},m)})),i.control_input.type=l.type,E(n,"click",e=>{var t=C(e.target,"[data-selectable]");t&&(i.onOptionSelect(e,t),L(e,!0))}),E(r,"click",e=>{var t=C(e.target,"[data-ts-item]",r);t&&i.onItemSelect(e,t)?L(e,!0):""==s.value&&(i.onClick(),L(e,!0))}),E(a,"keydown",e=>i.onKeyDown(e)),E(s,"keypress",e=>i.onKeyPress(e)),E(s,"input",e=>i.onInput(e)),E(a,"resize",()=>i.positionDropdown(),c),E(a,"blur",e=>i.onBlur(e)),E(a,"focus",e=>i.onFocus(e)),E(a,"paste",e=>i.onPaste(e));const y=e=>{var t=e.composedPath()[0];if(!o.contains(t)&&!n.contains(t))return i.isFocused&&i.blur(),void i.inputState();t==s&&i.isOpen?e.stopPropagation():L(e,!0)};var O=()=>{i.isOpen&&i.positionDropdown()};E(document,"mousedown",y),E(window,"scroll",O,c),E(window,"resize",O,c),this._destroy=()=>{document.removeEventListener("mousedown",y),window.removeEventListener("sroll",O),window.removeEventListener("resize",O),h&&h.removeEventListener("click",g)},this.revertSettings={innerHTML:l.innerHTML,tabIndex:l.tabIndex},l.tabIndex=-1,l.insertAdjacentElement("afterend",i.wrapper),i.sync(!1),e.items=[],delete e.optgroups,delete e.options,E(l,"invalid",e=>{i.isValid&&(i.isValid=!1,i.isInvalid=!0,i.refreshState())}),i.updateOriginalInput(),i.refreshItems(),i.close(!1),i.inputState(),i.isSetup=!0,l.disabled?i.disable():i.enable(),i.on("change",this.onChange),_(l,"tomselected","ts-hidden-accessible"),i.trigger("initialize"),!0===e.preload&&i.preload()}setupOptions(e=[],t=[]){this.addOptions(e),w(t,e=>{this.registerOptionGroup(e)})}setupTemplates(){var i=this.settings.labelField,s=this.settings.optgroupLabelField;this.settings.render=Object.assign({},{optgroup:e=>{let t=document.createElement("div");return t.className="optgroup",t.appendChild(e.options),t},optgroup_header:(e,t)=>'<div class="optgroup-header">'+t(e[s])+"</div>",option:(e,t)=>"<div>"+t(e[i])+"</div>",item:(e,t)=>"<div>"+t(e[i])+"</div>",option_create:(e,t)=>'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"},this.settings.render)}setupCallbacks(){var e,t,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in i)(t=this.settings[i[e]])&&this.on(e,t)}sync(e=!0){var t=this,e=e?G(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(e.options,e.optgroups),t.setValue(e.items,!0),t.lastQuery=null}onClick(){var e=this;if(0<e.activeItems.length)return e.clearActiveItems(),void e.focus();e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){i(this.input,"input"),i(this.input,"change")}onPaste(e){var t=this;t.isInputHidden||t.isLocked?L(e):t.settings.splitOn&&setTimeout(()=>{var e=t.inputValue();e.match(t.settings.splitOn)&&(e=e.trim().split(t.settings.splitOn),w(e,e=>{t.createItem(e)}))},0)}onKeyPress(e){var t,i=this;if(!i.isLocked)return t=String.fromCharCode(e.keyCode||e.which),i.settings.create&&"multi"===i.settings.mode&&t===i.settings.delimiter?(i.createItem(),void L(e)):void 0;L(e)}onKeyDown(e){var t,i=this;if(i.isLocked)9!==e.keyCode&&L(e);else{switch(e.keyCode){case 65:if(P(A,e)&&""==i.control_input.value)return L(e),void i.selectAll();break;case 27:return i.isOpen&&(L(e,!0),i.close()),void i.clearActiveItems();case 40:return!i.isOpen&&i.hasOptions?i.open():i.activeOption&&(t=i.getAdjacent(i.activeOption,1))&&i.setActiveOption(t),void L(e);case 38:return i.activeOption&&(t=i.getAdjacent(i.activeOption,-1))&&i.setActiveOption(t),void L(e);case 13:return void(i.canSelect(i.activeOption)?(i.onOptionSelect(e,i.activeOption),L(e)):i.settings.create&&i.createItem()&&L(e));case 37:return void i.advanceSelection(-1,e);case 39:return void i.advanceSelection(1,e);case 9:return void(i.settings.selectOnTab&&(i.canSelect(i.activeOption)&&(i.onOptionSelect(e,i.activeOption),L(e)),i.settings.create&&i.createItem()&&L(e)));case 8:case 46:return void i.deleteSelection(e)}i.isInputHidden&&!P(A,e)&&L(e)}}onInput(e){var t,i=this;i.isLocked||(t=i.inputValue(),i.lastValue!==t&&(i.lastValue=t,i.settings.shouldLoad.call(i,t)&&i.load(t),i.refreshOptions(),i.trigger("type",t)))}onFocus(e){var t=this,i=t.isFocused;if(t.isDisabled)return t.blur(),void L(e);t.ignoreFocus||(t.isFocused=!0,"focus"===t.settings.preload&&t.preload(),i||t.trigger("focus"),t.activeItems.length||(t.showInput(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){var t,i;!1!==document.hasFocus()&&(t=this).isFocused&&(t.isFocused=!1,t.ignoreFocus=!1,i=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")},t.settings.create&&t.settings.createOnBlur?t.createItem(null,!1,i):i())}onOptionSelect(e,t){var i,s=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?s.createItem(null,!0,()=>{s.settings.closeAfterSelect&&s.close()}):void 0!==(i=t.dataset.value)&&(s.lastQuery=null,s.addItem(i),s.settings.closeAfterSelect&&s.close(),!s.settings.hideSelected&&e.type&&/click/.test(e.type)&&s.setActiveOption(t)))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){return!this.isLocked&&"multi"===this.settings.mode&&(L(e),this.setActiveItem(t,e),!0)}canLoad(e){return!!this.settings.load&&!this.loadedSearches.hasOwnProperty(e)}load(e){var t,i=this;i.canLoad(e)&&(_(i.wrapper,i.settings.loadingClass),i.loading++,t=i.loadCallback.bind(i),i.settings.load.call(i,e,t))}loadCallback(e,t){var i=this;i.loading=Math.max(i.loading-1,0),i.lastQuery=null,i.clearActiveOption(),i.setupOptions(e,t),i.refreshOptions(i.isFocused&&!i.isInputHidden),i.loading||I(i.wrapper,i.settings.loadingClass),i.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input;t.value!==e&&(t.value=e,i(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){M(this,t?[]:["change"],()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){this.settings.maxItems=e=0===e?null:e,this.refreshState()}setActiveItem(e,t){var i,s,n,o,r,l=this;if("single"!==l.settings.mode){if(!e)return l.clearActiveItems(),void(l.isFocused&&l.showInput());if("click"===(i=t&&t.type.toLowerCase())&&P("shiftKey",t)&&l.activeItems.length){for(r=l.getLastActive(),(r=Array.prototype.indexOf.call(l.control.children,r))>(n=Array.prototype.indexOf.call(l.control.children,e))&&(o=r,r=n,n=o),s=r;s<=n;s++)e=l.control.children[s],-1===l.activeItems.indexOf(e)&&l.setActiveItemClass(e);L(t)}else"click"===i&&P(A,t)||"keydown"===i&&P("shiftKey",t)?e.classList.contains("active")?l.removeActiveItem(e):l.setActiveItemClass(e):(l.clearActiveItems(),l.setActiveItemClass(e));l.hideInput(),l.isFocused||l.focus()}}setActiveItemClass(e){var t=this.control.querySelector(".last-active");t&&I(t,"last-active"),_(e,"active last-active"),this.trigger("item_select",e),-1==this.activeItems.indexOf(e)&&this.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),I(e,"active")}clearActiveItems(){I(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,S(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),S(e,{"aria-selected":"true"}),_(e,"active"),this.scrollToOption(e)))}scrollToOption(e,t){if(e){const i=this.dropdown_content,s=i.clientHeight,n=i.scrollTop||0,o=e.offsetHeight,r=e.getBoundingClientRect().top-i.getBoundingClientRect().top+n;s+n<r+o?this.scroll(r-s+o,t):r<n&&this.scroll(r,t)}}scroll(e,t){const i=this.dropdown_content;t&&(i.style.scrollBehavior=t),i.scrollTop=e,i.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(I(this.activeOption,"active"),S(this.activeOption,{"aria-selected":null})),this.activeOption=null,S(this.focus_node,{"aria-activedescendant":null})}selectAll(){var e;"single"!==this.settings.mode&&(e=this.controlChildren()).length&&(this.hideInput(),this.close(),this.activeItems=e,_(e,"active"))}inputState(){var e=this;e.control.contains(e.control_input)&&(S(e.control_input,{placeholder:e.settings.placeholder}),0<e.activeItems.length||!e.isFocused&&e.settings.hidePlaceholder&&0<e.items.length?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&0<e.items.length&&S(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}hideInput(){this.inputState()}showInput(){this.inputState()}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||(e.ignoreFocus=!0,(e.control_input.offsetWidth?e.control_input:e.focus_node).focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return"string"==typeof e.sortField&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,i,s,n=this,o=this.getSearchOptions();if(n.settings.score&&"function"!=typeof(s=n.settings.score.call(n,e)))throw new Error('Tom Select "score" setting must be a function that returns a function');if(e!==n.lastQuery?(n.lastQuery=e,i=n.sifter.search(e,Object.assign(o,{score:s})),n.currentResults=i):i=Object.assign({},n.currentResults),n.settings.hideSelected)for(t=i.items.length-1;0<=t;t--){var r=x(i.items[t].id);r&&-1!==n.items.indexOf(r)&&i.items.splice(t,1)}return i}refreshOptions(e=!0){var s,n,o,t,r,l,a,i,c,d,p;const u={},h=[];var g=this,v=g.inputValue(),m=g.search(v),f=g.activeOption,y=g.settings.shouldOpen||!1,O=g.dropdown_content;for(f&&(c=f.dataset.value,d=f.closest("[data-group]")),t=m.items.length,0<(t="number"==typeof g.settings.maxOptions?Math.min(t,g.settings.maxOptions):t)&&(y=!0),s=0;s<t;s++){let e=m.items[s].id,t=g.options[e],i=g.getOption(e,!0);for(g.settings.hideSelected||i.classList.toggle("selected",g.items.includes(e)),r=t[g.settings.optgroupField]||"",n=0,o=(l=Array.isArray(r)?r:[r])&&l.length;n<o;n++)r=l[n],g.optgroups.hasOwnProperty(r)||(r=""),u.hasOwnProperty(r)||(u[r]=document.createDocumentFragment(),h.push(r)),0<n&&(i=i.cloneNode(!0),S(i,{id:t.$id+"-clone-"+n,"aria-selected":null}),i.classList.add("ts-cloned"),I(i,"active")),c==e&&d&&d.dataset.group===r&&(f=i),u[r].appendChild(i)}this.settings.lockOptgroupOrder&&h.sort((e,t)=>(g.optgroups[e]&&g.optgroups[e].$order||0)-(g.optgroups[t]&&g.optgroups[t].$order||0)),a=document.createDocumentFragment(),w(h,e=>{var t,i;g.optgroups.hasOwnProperty(e)&&u[e].children.length?(t=document.createDocumentFragment(),i=g.render("optgroup_header",g.optgroups[e]),V(t,i),V(t,u[e]),i=g.render("optgroup",{group:g.optgroups[e],options:t}),V(a,i)):V(a,u[e])}),O.innerHTML="",V(O,a),g.settings.highlight&&(b=O.querySelectorAll("span.highlight"),Array.prototype.forEach.call(b,function(e){var t=e.parentNode;t.replaceChild(e.firstChild,e),t.normalize()}),m.query.length&&m.tokens.length&&w(m.tokens,e=>{B(O,e.regex)}));var b=e=>{e=g.render(e,{input:v});return e&&(y=!0,O.insertBefore(e,O.firstChild)),e};if(g.loading?b("loading"):g.settings.shouldLoad.call(g,v)?0===m.items.length&&b("no_results"):b("not_loading"),(i=g.canCreate(v))&&(p=b("option_create")),g.hasOptions=0<m.items.length||i,y){if(0<m.items.length){if(!O.contains(f)&&"single"===g.settings.mode&&g.items.length&&(f=g.getOption(g.items[0])),!O.contains(f)){let e=0;p&&!g.settings.addPrecedence&&(e=1),f=g.selectable()[e]}}else p&&(f=p);e&&!g.isOpen&&(g.open(),g.scrollToOption(f,"auto")),g.setActiveOption(f)}else g.clearActiveOption(),e&&g.isOpen&&g.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){var i=this;if(Array.isArray(e))return i.addOptions(e,t),!1;var s=x(e[i.settings.valueField]);return null!==s&&!i.options.hasOwnProperty(s)&&(e.$order=e.$order||++i.order,e.$id=i.inputId+"-opt-"+e.$order,i.options[s]=e,i.lastQuery=null,t&&(i.userOptions[s]=t,i.trigger("option_add",s,e)),s)}addOptions(e,t=!1){w(e,e=>{this.addOption(e,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=x(e[this.settings.optgroupValueField]);return null!==t&&(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){t[this.settings.optgroupValueField]=e,(e=this.registerOptionGroup(t))&&this.trigger("optgroup_add",e,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){var i=this,e=x(e),s=x(t[i.settings.valueField]);if(null!==e&&i.options.hasOwnProperty(e)){if("string"!=typeof s)throw new Error("Value must be set in option data");const n=i.getOption(e),o=i.getItem(e);if(t.$order=t.$order||i.options[e].$order,delete i.options[e],i.uncacheValue(s),i.options[s]=t,n){if(i.dropdown_content.contains(n)){const e=i._render("option",t);O(n,e),i.activeOption===n&&i.setActiveOption(e)}n.remove()}o&&(-1!==(e=i.items.indexOf(e))&&i.items.splice(e,1,s),e=i._render("item",t),o.classList.contains("active")&&_(e,"active"),O(o,e)),i.lastQuery=null}}removeOption(e,t){var i=this;e=k(e),i.uncacheValue(e),delete i.userOptions[e],delete i.options[e],i.lastQuery=null,i.trigger("option_remove",e),i.removeItem(e,t)}clearOptions(){this.loadedSearches={},this.userOptions={},this.clearCache();var i={};w(this.options,(e,t)=>{0<=this.items.indexOf(t)&&(i[t]=this.options[t])}),this.options=this.sifter.items=i,this.lastQuery=null,this.trigger("option_clear")}getOption(e,t=!1){var i=x(e);if(null!==i&&this.options.hasOwnProperty(i)){const e=this.options[i];if(e.$div)return e.$div;if(t)return this._render("option",e)}return null}getAdjacent(t,i,e="option"){var s;if(!t)return null;s="item"==e?this.controlChildren():this.dropdown_content.querySelectorAll("[data-selectable]");for(let e=0;e<s.length;e++)if(s[e]==t)return 0<i?s[e+1]:s[e-1];return null}getItem(e){if("object"==typeof e)return e;e=x(e);return null!==e?this.control.querySelector(`[data-value="${Q(e)}"]`):null}addItems(e,i){var s=this,n=Array.isArray(e)?e:[e];for(let e=0,t=(n=n.filter(e=>-1===s.items.indexOf(e))).length;e<t;e++)s.isPending=e<t-1,s.addItem(n[e],i)}addItem(r,l){M(this,l?[]:["change","dropdown_close"],()=>{var e,t,i,s=this,n=s.settings.mode,o=x(r);o&&-1!==s.items.indexOf(o)&&("single"===n&&s.close(),"single"===n||!s.settings.duplicates)||null===o||!s.options.hasOwnProperty(o)||("single"===n&&s.clear(l),"multi"===n&&s.isFull())||(i=s._render("item",s.options[o]),s.control.contains(i)&&(i=i.cloneNode(!0)),e=s.isFull(),s.items.splice(s.caretPos,0,o),s.insertAtCaret(i),s.isSetup&&(!s.isPending&&s.settings.hideSelected&&(t=s.getOption(o),(t=s.getAdjacent(t,1))&&s.setActiveOption(t)),s.isPending||s.settings.closeAfterSelect||s.refreshOptions(s.isFocused&&"single"!==n),0!=s.settings.closeAfterSelect&&s.isFull()?s.close():s.isPending||s.positionDropdown(),s.trigger("item_add",o,i),s.isPending||s.updateOriginalInput({silent:l})),s.isPending&&(e||!s.isFull())||(s.inputState(),s.refreshState()))})}removeItem(e=null,t){var i,s,n,o=this;(e=o.getItem(e))&&(s=e.dataset.value,n=d(e),e.remove(),e.classList.contains("active")&&(i=o.activeItems.indexOf(e),o.activeItems.splice(i,1),I(e,"active")),o.items.splice(n,1),o.lastQuery=null,!o.settings.persist&&o.userOptions.hasOwnProperty(s)&&o.removeOption(s,t),n<o.caretPos&&o.setCaret(o.caretPos-1),o.updateOriginalInput({silent:t}),o.refreshState(),o.positionDropdown(),o.trigger("item_remove",s,e))}createItem(e=null,t,i=()=>{}){var s=this,n=s.caretPos;if(e=e||s.inputValue(),!s.canCreate(e))return i(),!1;s.lock();var o=!1,r=e=>{return s.unlock(),!e||"object"!=typeof e||"string"!=typeof(t=x(e[s.settings.valueField]))?i():(s.setTextboxValue(),s.addOption(e,!0),s.setCaret(n),s.addItem(t),i(e),void(o=!0));var t},e="function"==typeof s.settings.create?s.settings.create.call(this,e,r):{[s.settings.labelField]:e,[s.settings.valueField]:e};return o||r(e),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){var e=this,t=(e.refreshValidityState(),e.isFull()),i=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const s=e.wrapper.classList;s.toggle("focus",e.isFocused),s.toggle("disabled",e.isDisabled),s.toggle("required",e.isRequired),s.toggle("invalid",!e.isValid),s.toggle("locked",i),s.toggle("full",t),s.toggle("input-active",e.isFocused&&!e.isInputHidden),s.toggle("dropdown-active",e.isOpen),s.toggle("has-options",(i=e.options,0===Object.keys(i).length)),s.toggle("has-items",0<e.items.length)}refreshValidityState(){var e=this;e.input.checkValidity&&(e.isValid=e.input.checkValidity(),e.isInvalid=!e.isValid)}isFull(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems}updateOriginalInput(s={}){const n=this;var t,i;const o=n.input.querySelector('option[value=""]');if(n.is_select_tag){const s=[];function r(e,t,i){return(e=e||f('<option value="'+F(t)+'">'+F(i)+"</option>"))!=o&&n.input.append(e),s.push(e),e.selected=!0,e}n.input.querySelectorAll("option:checked").forEach(e=>{e.selected=!1}),0==n.items.length&&"single"==n.settings.mode?r(o,"",""):n.items.forEach(e=>{t=n.options[e],i=t[n.settings.labelField]||"",s.includes(t.$option)?r(n.input.querySelector(`option[value="${Q(e)}"]:not(:checked)`),e,i):t.$option=r(t.$option,e,i)})}else n.input.value=n.getValue();n.isSetup&&!s.silent&&n.trigger("change",n.getValue())}open(){var e=this;e.isLocked||e.isOpen||"multi"===e.settings.mode&&e.isFull()||(e.isOpen=!0,S(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),o(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),o(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,i=t.isOpen;e&&(t.setTextboxValue(),"single"===t.settings.mode&&t.items.length&&t.hideInput()),t.isOpen=!1,S(t.focus_node,{"aria-expanded":"false"}),o(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),i&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){var e,t,i;"body"===this.settings.dropdownParent&&(e=(t=this.control).getBoundingClientRect(),t=t.offsetHeight+e.top+window.scrollY,i=e.left+window.scrollX,o(this.dropdown,{width:e.width+"px",top:t+"px",left:i+"px"}))}clear(e){var t,i=this;i.items.length&&(t=i.controlChildren(),w(t,e=>{i.removeItem(e,!0)}),i.showInput(),e||i.updateOriginalInput(),i.trigger("clear"))}insertAtCaret(e){const t=this.caretPos,i=this.control;i.insertBefore(e,i.children[t]),this.setCaret(t+1)}deleteSelection(e){var t,i=this,s=e&&8===e.keyCode?-1:1,n={start:(n=i.control_input).selectionStart||0,length:(n.selectionEnd||0)-(n.selectionStart||0)};const o=[];if(i.activeItems.length)t=a(i.activeItems,s),t=d(t),0<s&&t++,w(i.activeItems,e=>o.push(e));else if((i.isFocused||"single"===i.settings.mode)&&i.items.length){const e=i.controlChildren();s<0&&0===n.start&&0===n.length?o.push(e[i.caretPos-1]):0<s&&n.start===i.inputValue().length&&o.push(e[i.caretPos])}s=o.map(e=>e.dataset.value);if(!s.length||"function"==typeof i.settings.onDelete&&!1===i.settings.onDelete.call(i,s,e))return!1;for(L(e,!0),void 0!==t&&i.setCaret(t);o.length;)i.removeItem(o.pop());return i.showInput(),i.positionDropdown(),i.refreshOptions(!1),!0}advanceSelection(e,t){var i,s=this;s.rtl&&(e*=-1),s.inputValue().length||(P(A,t)||P("shiftKey",t)?(i=(t=s.getLastActive(e))?t.classList.contains("active")?s.getAdjacent(t,e,"item"):t:0<e?s.control_input.nextElementSibling:s.control_input.previousElementSibling)&&(i.classList.contains("active")&&s.removeActiveItem(t),s.setActiveItemClass(i)):s.moveCaret(e))}moveCaret(e){}getLastActive(e){var t=this.control.querySelector(".last-active");if(t)return t;t=this.control.querySelectorAll(".active");return t?a(t,e):void 0}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.isLocked=!0,this.refreshState()}unlock(){this.isLocked=!1,this.refreshState()}disable(){var e=this;e.input.disabled=!0,e.control_input.disabled=!0,e.focus_node.tabIndex=-1,e.isDisabled=!0,this.close(),e.lock()}enable(){var e=this;e.input.disabled=!1,e.control_input.disabled=!1,e.focus_node.tabIndex=e.tabIndex,e.isDisabled=!1,e.unlock()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,I(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){return"function"!=typeof this.settings.render[e]?null:this._render(e,t)}_render(e,t){var i,s,n="",o=this;return"option"!==e&&"item"!=e||(n=k(t[o.settings.valueField])),null!=(s=o.settings.render[e].call(this,t,F))&&(s=f(s),"option"===e||"option_create"===e?t[o.settings.disabledField]?S(s,{"aria-disabled":"true"}):S(s,{"data-selectable":""}):"optgroup"===e&&(i=t.group[o.settings.optgroupValueField],S(s,{"data-group":i}),t.group[o.settings.disabledField]&&S(s,{"data-disabled":""})),"option"!==e&&"item"!==e||(S(s,{"data-value":n}),"item"===e?(_(s,o.settings.itemClass),S(s,{"data-ts-item":""})):(_(s,o.settings.optionClass),S(s,{role:"option",id:t.$id}),o.options[n].$div=s))),s}clearCache(){w(this.options,(e,t)=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&0<e.length&&this.settings.createFilter.call(this,e)}hook(i,e,s){var n=this,o=n[e];n[e]=function(){var e,t;return"after"===i&&(e=o.apply(n,arguments)),t=s.apply(n,arguments),"instead"===i?t:e="before"===i?o.apply(n,arguments):e}}}return e.define("change_listener",function(){E(this.input,"change",()=>{this.sync()})}),e.define("checkbox_options",function(){function i(t){setTimeout(()=>{var e=t.querySelector("input");t.classList.contains("selected")?e.checked=!0:e.checked=!1},1)}var n=this,s=n.onOptionSelect;n.settings.hideSelected=!1;n.hook("after","setupTemplates",()=>{var s=n.settings.render.option;n.settings.render.option=(e,t)=>{var t=f(s.call(n,e,t)),i=document.createElement("input"),e=(i.addEventListener("click",function(e){L(e)}),i.type="checkbox",x(e[n.settings.valueField]));return e&&-1<n.items.indexOf(e)&&(i.checked=!0),t.prepend(i),t}}),n.on("item_remove",e=>{e=n.getOption(e);e&&(e.classList.remove("selected"),i(e))}),n.hook("instead","onOptionSelect",(e,t)=>{if(t.classList.contains("selected"))return t.classList.remove("selected"),n.removeItem(t.dataset.value),n.refreshOptions(),void L(e,!0);s.call(n,e,t),i(t)})}),e.define("clear_button",function(e){const t=this,i=Object.assign({className:"clear-button",title:"Clear All",html:e=>`<div class="${e.className}" title="${e.title}">&times;</div>`},e);t.on("initialize",()=>{var e=f(i.html(i));e.addEventListener("click",e=>{t.clear(),"single"===t.settings.mode&&t.settings.allowEmptyOption&&t.addItem(""),e.preventDefault(),e.stopPropagation()}),t.control.appendChild(e)})}),e.define("drag_drop",function(){var t,i,s=this;if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');"multi"===s.settings.mode&&(t=s.lock,i=s.unlock,s.hook("instead","lock",()=>{var e=$(s.control).data("sortable");return e&&e.disable(),t.call(s)}),s.hook("instead","unlock",()=>{var e=$(s.control).data("sortable");return e&&e.enable(),i.call(s)}),s.on("initialize",()=>{var i=$(s.control).sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:s.isLocked,start:(e,t)=>{t.placeholder.css("width",t.helper.css("width")),i.css({overflow:"visible"})},stop:()=>{i.css({overflow:"hidden"});var e=[];i.children("[data-value]").each(function(){this.dataset.value&&e.push(this.dataset.value)}),s.setValue(e)}})}))}),e.define("dropdown_header",function(e){const i=this,s=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:e=>'<div class="'+e.headerClass+'"><div class="'+e.titleRowClass+'"><span class="'+e.labelClass+'">'+e.title+'</span><a class="'+e.closeClass+'">&times;</a></div></div>'},e);i.on("initialize",()=>{var e=f(s.html(s)),t=e.querySelector("."+s.closeClass);t&&t.addEventListener("click",e=>{L(e,!0),i.close()}),i.dropdown.insertBefore(e,i.dropdown.firstChild)})}),e.define("caret_position",function(){var s=this;s.hook("instead","setCaret",i=>{"single"!==s.settings.mode&&s.control.contains(s.control_input)?(i=Math.max(0,Math.min(s.items.length,i)))==s.caretPos||s.isPending||s.controlChildren().forEach((e,t)=>{t<i?s.control_input.insertAdjacentElement("beforebegin",e):s.control.appendChild(e)}):i=s.items.length,s.caretPos=i}),s.hook("instead","moveCaret",e=>{var t;s.isFocused&&((t=s.getLastActive(e))?(t=d(t),s.setCaret(0<e?t+1:t),s.setActiveItem()):s.setCaret(s.caretPos+e))})}),e.define("dropdown_input",function(){var i=this;i.settings.shouldOpen=!0,i.hook("before","setup",()=>{i.focus_node=i.control,_(i.control_input,"dropdown-input");const e=f('<div class="dropdown-input-wrap">');e.append(i.control_input),i.dropdown.insertBefore(e,i.dropdown.firstChild)}),i.on("initialize",()=>{i.control_input.addEventListener("keydown",e=>{switch(e.keyCode){case 27:return i.isOpen&&(L(e,!0),i.close()),void i.clearActiveItems();case 9:i.focus_node.tabIndex=-1}return i.onKeyDown.call(i,e)}),i.on("blur",()=>{i.focus_node.tabIndex=i.isDisabled?-1:i.tabIndex}),i.on("dropdown_open",()=>{i.control_input.focus()});const t=i.onBlur;i.hook("instead","onBlur",e=>{if(!e||e.relatedTarget!=i.control_input)return t.call(i)}),E(i.control_input,"blur",()=>i.onBlur()),i.hook("before","close",()=>{i.isOpen&&i.focus_node.focus()})})}),e.define("input_autogrow",function(){var s=this;s.on("initialize",()=>{var e=document.createElement("span"),t=s.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",s.wrapper.appendChild(e);for(const s of["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"])e.style[s]=t.style[s];var i=()=>{0<s.items.length?(e.textContent=t.value,t.style.width=e.clientWidth+"px"):t.style.width=""};i(),s.on("update item_add item_remove",i),E(t,"input",i),E(t,"keyup",i),E(t,"blur",i),E(t,"update",i)})}),e.define("no_backspace_delete",function(){var t=this,i=t.deleteSelection;this.hook("instead","deleteSelection",e=>!!t.activeItems.length&&i.call(t,e))}),e.define("no_active_items",function(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}),e.define("optgroup_columns",function(){var s=this,n=s.onKeyDown;s.hook("instead","onKeyDown",e=>{var t,i;if(!s.isOpen||37!==e.keyCode&&39!==e.keyCode)return n.call(s,e);i=C(s.activeOption,"[data-group]"),t=d(s.activeOption,"[data-selectable]"),(i=i&&(37===e.keyCode?i.previousSibling:i.nextSibling))&&(i=(e=i.querySelectorAll("[data-selectable]"))[Math.min(e.length-1,t)])&&s.setActiveOption(i)})}),e.define("remove_button",function(e){var n,e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},e),o=this;e.append&&(n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+F(e.title)+'">'+e.label+"</a>",o.hook("after","setupTemplates",()=>{var s=o.settings.render.item;o.settings.render.item=(e,t)=>{var i=f(s.call(o,e,t)),e=f(n);return i.appendChild(e),E(e,"mousedown",e=>{L(e,!0)}),E(e,"click",e=>{L(e,!0),o.isLocked||(e=i.dataset.value,o.removeItem(e),o.refreshOptions(!1))}),i}}))}),e.define("restore_on_backspace",function(e){const t=this,i=Object.assign({text:e=>e[t.settings.labelField]},e);t.on("item_remove",function(e){""===t.control_input.value.trim()&&(e=t.options[e])&&t.setTextboxValue(i.text.call(t,e))})}),e.define("virtual_scroll",function(){const i=this,t=i.canLoad,e=i.clearActiveOption,s=i.loadCallback;var n,o={},r=!1;if(!i.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";function l(e){return!("number"==typeof i.settings.maxOptions&&n.children.length>=i.settings.maxOptions||!(e in o&&o[e]))}i.settings.sortField=[{field:"$order"},{field:"$score"}],i.setNextUrl=function(e,t){o[e]=t},i.getUrl=function(e){if(e in o){const i=o[e];return o[e]=!1,i}return o={},i.settings.firstUrl(e)},i.hook("instead","clearActiveOption",()=>{if(!r)return e.call(i)}),i.hook("instead","canLoad",e=>e in o?l(e):t.call(i,e)),i.hook("instead","loadCallback",(e,t)=>{r||i.clearOptions(),s.call(i,e,t),r=!1}),i.hook("after","refreshOptions",()=>{var e,t=i.lastValue;l(t)?(e=i.render("loading_more",{query:t}))&&e.setAttribute("data-selectable",""):t in o&&!n.querySelector(".no-results")&&(e=i.render("no_more_results",{query:t})),e&&(_(e,i.settings.optionClass),n.append(e))}),i.on("initialize",()=>{n=i.dropdown_content,i.settings.render=Object.assign({},{loading_more:function(){return'<div class="loading-more-results">Loading more results ... </div>'},no_more_results:function(){return'<div class="no-more-results">No more results</div>'}},i.settings.render),n.addEventListener("scroll",function(){n.clientHeight/(n.scrollHeight-n.scrollTop)<.95||l(i.lastValue)&&!r&&(r=!0,i.load.call(i,i.lastValue))})})}),e});var tomSelect=function(e,t){return new TomSelect(e,t)};